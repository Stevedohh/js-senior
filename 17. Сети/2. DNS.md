
**Domain Name System** - это протокол для разрешение доменных имён.

Протокол предназначен для связывания названия доменов с IP-адресами компьютеров, соответствующих этим доменам, а также для получения информации о маршрутизации почты, обслуживающих узлах для протоколов в домене (SRV запись).

> Спецификации (RFC 1034) и (RFC 1035)

> Протокол *DNS* использует порт 53.



---
#### Основные понятия
---
1. **Зона** - это любая часть дерева системы доменных имен, размещаемая как единое целое на некотором DNS-сервере.

2. **Домен** - это именованная ветвь или поддерево в дереве имен DNS, то есть определенный узел, включающий в себя все подчиненные узлы.
	- Доменное имя начинается с точки (корневого домена) и проходит через домены первого, второго и если нужно третьего и т.д. уровней и завершается именем хоста.
	- Доменное имя полностью отражает структуру иерархии DNS.

3. **FQDN** (Fully Qualifed Domain Name) - это полностью определённое имя домена, однозначно определяющее доменное имя и включающее в себя имена всех родительских доменов иерархии DNS, в том числе и корневого.
```
mail.vksit.com.
 |     |  | | |
 |     |  | | + - корневой домен
 |	    |  | + --- домен первого уровня
 |     |  + ----- точка, разделяющая домены/части FQDN
 | 	 + -------- домен второго уровня 
 + -------------- поддомен/домен третьего уровня, возможно - имя хоста
```

4. **Поддомены** — это подчиненные домены древа.
	- Все домены в интернете являются подчиненными за исключением корневого.
	- Например домен vksit является поддоменом домена com, а com, в свою очередь — поддоменом корневого домена.



---
#### Пространство имен DNS
---
![[Снимок экрана 2022-10-27 в 22.40.20.png]]



---
#### Механизмы разрешения доменных имен
---
1. Локальный для каждого компьютера файл hosts. 
2. Централизованная иерархическая служба имен DNS.



---
#### Характеристи DNS в глобальной сети
---
1. Распределённость администрирования 
2. Распределённость хранения информации 
3. Кеширование информации 
4. Иерархическая структура 
5. Резервирование



---
#### Ресурсные записи
---
Это единица хранения и передачи информации в DNS. Каждая запись несет в себе информацию соответствия какого-то имени и служебной информации в DNS, например соответствие имени домена — IP адреса. 

**Запись ресурса состоит из следующих полей:**
- NAME - доменное имя, к которому привязана или которому «принадлежит» данная ресурсная запись, либо IP адрес. 
> При отсутствии данного поля, запись ресурса наследуется от предыдущей записи.

- TTL *(Time To Live)* - время хранения записи в кэше DNS, после указанного времени запись удаляется. 
> Данное поле может не указываться в индивидуальных записях ресурсов, но тогда оно должно быть указано в начале файла зоны и будет наследоваться всеми записями.

- CLASS - определяет тип сети, в 99,99% случаях используется IN *(Internet)*. Данное поле было создано из предположения, что DNS может работать и в других типах сетей, кроме TCP/IP.

- TYPE - тип записи синтаксис и назначение записи  

- DATA - различная информация, формат и синтаксис которой определяется типом.



---
#### Типы ресурсных записей
---

| Тип   | Функция            | Тип зоны          |
| ----- | ------------------ | ----------------- |
| A     | Host Adress        | Прямая            |
| CNAME | Canonical Name     | Прямая            |
| MX    | Mail Exchanger     | Прямая            |
| NS    | Name Server        | Прямая и обратная |
| PTR   | Pointer            | Обратная          |
| SOA   | Start of Authority | Прямая и обратная |
| SRV   | Server Locator     | Прямая            |

---

**A** - *(address record/запись адреса)* отображают имя хоста *(доменное имя)* на адрес IPv4. Для каждого сетевого интерфейса машины должна быть сделана одна A-запись. Например, следующая запись отображает доменное имя (vksit.ru.) в IPv4 адрес хоста (81.177.139.65):
```
NAME - vksit.ru.
TTL - 86400
CLASS - IN
DATA - 81.177.139.65
```

---

**CNAME** - *(canonical name record/каноническая запись имени)* отображает псевдоним на реальное имя (для перенаправления на другое имя), например, следующая запись задает псевдоним *ftp* для хоста `www.vksit.ru.`
```
NAME - vksit.ru.
TTL - 86400
CLASS - IN
DATA - 81.177.139.65
CNAME - www.vksit.ru.
```

---

**MX** - *(mail exchange)* указывает хосты для доставки почты, адресованной домену.

> Поле **NAME** указывает домен назначения, поля TTL, CLASS - стандартное значение, поле **TYPE** принимает значение **MX**, а поле DATA указывает приоритет и через пробел - доменное имя хоста, ответственного за прием почты.

```

```

---

**NS** - *(name server/сервер имён)* указывает на DNS-сервер, обслуживающий данный домен.

> Если записи NS относятся к серверам имен для текущей зоны, доменная система имен их практически не использует. Они просто поясняют, как организована зона и какие машины играют ключевую роль в обеспечении сервиса имен. Например, зону name. обслуживают следующие NS:

```

```

---

**PTR** - *(pointer)* отображает IP-адрес в доменное имя (о данном типе записи поговорим ниже в разделе обратного преобразования имен).

---

**SOA** - *(Start of Authority/начальная запись зоны)* описывает основные/начальные настройки зоны, определяет зону ответственности данного сервера. Для каждой зоны должна существовать только одна запись SOA и она должна быть первая.

 
- Поле Name содержит имя домена/зоны
- Поля TTL, CLASS — стандартное значение
- Поле TYPE принимает значение SOA

- Поле DATA состоит из нескольких значений, разделенных пробелами: имя главного DNS (Primary Name Server), адрес администратора зоны, далее в скобках — серийный номер файла зоны (Serial number). При каждом внесении изменений в файл зоны данное значение необходимо увеличивать, это указывает вторичным серверам, что зона изменена, и что им необходимо обновить у себя зону.

- Значения таймеров (Refresh — указывает, как часто вторичные серверы должны опрашивать первичный, чтобы узнать, не увеличился ли серийный номер зоны, Retry — время ожидания после неудачной попытки опроса, Expire — максимальное время, в течение которого вторичный сервер может использовать информацию о полученной зоне, Minimum TTL — минимальное время, в течение которого данные остаются в кэше вторичного сервера).





Формат SOA-записи
Primary Name Server: Имя первичного DNS-сервера зоны

Hostmaster: Контактный адрес лица, ответственного за администрирование файла зоны. Обратите внимание на то, что вместо «@» используется «.»

Serial number: Серийный номер файла зоны. 32-разрядное целое число, меняющееся при каждом обновлении зоны.

Refresh: Время (в секундах) ожидания вторичного DNS перед запросом SOA-записи с первичного. По истечении данного времени, вторичный DNS обращается к первичному, для получения копии текущей SOA-записи. Первичный DNS-сервер выполняет этот запрос. Вторичный DNS-сервер сравнивает полученный серийный номер зоны с имеющимся. Если они отличаются, то осуществляется запрос к первичному DNS-серверу на трансфер зоны.

Retry: Время в секундах, вступает в действие тогда, когда первичный DNS-сервер недоступен. Интервал времени, по истечении которого вторичный DNS должен повторить попытку синхронизировать описание зоны с первичным.

Expire: Время (в секундах), в течение которого вторичный DNS будет пытаться завершить синхронизацию зоны с первичным. Если это время истечет до того, как синхронизация осуществится, зона на вторичном DNS-сервере истечет, и он перестанет обслуживать запросы об этой зоне.

Minimum TTL: Минимальное время жизни, применяемое ко всем ресурсным записям зоны. Это значение применяется в ответах на запросы с целью проинформировать остальные серверы, сколько времени они могут хранить данные в кэше.



**Пример файла «example.com» зоны прямого разрешения:**
```
@ IN SOA ns.example.com. root.example.com. ( 
10800 ; Refresh 3 hours  
3600 ; Retry 1 hour  
3600000 ; Expire 1000 hours
86400 ) ; Minimum 24 hours 

@ IN NS ns.example.com. 
@ IN NS ns2.example.com. 
@ IN A 10.0.0.152
@ IN MX 5 mx.example.com. 

ns IN A 10.0.0.152  
ns2 IN A 10.0.0.191 

mx IN A 10.0.0.152

www IN CNAME @
```


**Пример файла "0.0.10.in-addr.arpa" зоны обратного разрешения:**
```
@ IN SOA ns.examle.com. root.example.com. ( 
94102501 ; Serial  

10800 ; Refresh 3 hours  
3600 ; Retry 1 hour
3600000 ; Expire 1000 hours 
86400 ) ; Minimum 24 hours 

IN NS ns.examle.com.  
IN NS ns2.example.com. 152 
IN PTR example.com. 191 
IN PTR ns.example.com. 
* IN PTR example.com.
```


**Пример подключения файлов зон (на примере BIND):**
```
// подключение основной зоны 

zone "example.com" {  
type master;  
file "example.com";
};

// подключение обратной зоны 

zone "0.0.10.in-addr.arpa" {  
type master;  
file "0.0.10.in-addr.arpa";  
};
```



---
#### Реализация службы DNS
---
1.  BIND (Berkeley Internet Name Domain).
2.  Microsoft DNS Server



---
#### Режимы работы DNS сервера (на примере BIND)
---
1. **Кэширующий**. 
> Обрабатывает рекурсивные запросы, выполняет на ROOT серверах (файл /etc/root.hint). Необходима защита от DoS-атак.
2. **Перенаправляющий**. 
> Перенаправляет все запросы на другие DNS-сервера, не пытаясь решить их, затем их кэширует. Меньше рабочая нагрузка. Список серверов прописывается явно:
3. **Авторитетный** (первичный — master). 
4. **Авторитетный** (вторичный — slave).



---
#### Транзакции DNS
---
1. Запросы и ответы.

2. Динамическое обновление. DHCP-сервер удаляет данную ресурсную запись с типом A после того, как IP-адрес возвращается хостом.

3. Зонные пересылки. Вторичный (slave) сервер обновляет все содержимое своего зонногофайлаотпервичного(master)сервера вответнасообщениеDNSNOTIFY,либо основываясь на значении элемента данных Refresh в поле Start of Authority (SOA) ресурсной записи.

4. DNS NOTIFY. Всякий раз, когда выполняются изменения в зонном файле первичного (master) DNS-сервера, вторичные (slave) DNS-серверы, которые содержат идентичные данные, должны быть уведомлены об изменениях. Такое уведомление выполняется посредством сообщения DNS NOTIFY, которое указывает, что вторичному DNS-серверу следует начать зонную пересылку.



---
#### Типы запросов к DNS
---
1. Рекурсивный и нерекурсивный. При рекурсивном выполняется от имени клиента полный поиск нужной информации во всей системе DNS, при необходимости обращаясь к другим DNS-серверам.
2. Прямой и обратный DNS-запрос.



---
#### Утилиты для обращения к системе DNS
---
В Windows:
```shell
nslookup <имя или ip> [<DNS-сервер>]
```

В Linux:
```bash
host  {name} [server]
dig [@server] [name] [type]
```